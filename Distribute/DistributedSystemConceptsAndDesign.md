#Distributed System Concepts And Design
---
#book
[分布式系统概念与设计](https://book.douban.com/subject/2698938/)

#C1 分布式系统的特征
##定义
分布式系统是一个硬件或软件组件分布在不同网络计算机上，彼此之间通过消息传递进行通信和协调的系统
##特性
分布性
对等性
并发性
缺乏全局时钟
故障总会发生

##挑战
###1 异构性
网络、硬件、操作系统、编程语言、不同开发者完成的软件
中间件，提供编程抽象，屏蔽了异构性

###2 开放性
新的资源共享服务能否被增加和供多种客户程序使用的程度

###3 安全性
消息内容；身份；DDOS

###4 可伸缩性
控制物理资源开销
控制性能损失
防止软件资源用尽，ipv4
避免性能瓶颈

###5 故障处理
检测故障
掩盖故障
	消息不能到达时重传；
	双写，磁盘损坏，另一个仍然可读
容错
故障恢复
冗余

###6 并发性

###7 透明性
访问，操作方式，调用方式
位置
并发
复制，无需知道副本相关信息 
故障
移动
性能
伸缩

###8 服务质量

##分布式环境常见问题
通信异常
网络分区
三态
	成功、失败
	超时：网络端口，发送的消息丢失；处理完后，响应的消息丢失；因此无法判断是否处理成功
节点故障

----
#C2 系统模型
##1 物理模型
分布式系统底层硬件元素的表示
###基线物理模型
通过消息传递进行通信和协调动作的系统
###早期
规模：小
异构性：有限
开放性：
服务质量：
###互联网规模
可扩展的节点集合 通过互联网相连
规模：大
异构性：平台、语言、中间件 都较大
开放性：一系列标准
服务质量：一系列服务
###当代分布式
静态 分立 自治
规模：超大
异构性：维度增加
开放性：已有标准不能包含复杂系统
服务质量：已有的服务不能包含复杂系统
###超大规模
系统的系统

##2 体系结构模型
用独立指定的组件 以及 这些组件之间的关系 来表示的 结构
###体系结构元素
* 通信实体
进程，线程，硬件节点
对象
组件，依赖显式化

* 通信范型
请求-应答
RPC RMI
以上发送和接收的双向关系，多数情况，发送接收者同时存在
间接通信：
空间解耦，发送者不需要知道发送给谁；时间解耦，发送 接收不需要同时存在
1 组通信：一对多
2 发布-订阅
3 消息队列
4 元组空间：进程可以把任意结构化数据项放到一个持久元组空间，其他进程可以指定感兴趣的模式，从而在元组空间读或删除元组
5 分布式共享内存：DistributedSharedMemory

* 角色和责任
客户-服务器
对等体系结构，P2P

* 如何映射到物理设施，放置
Q：性能，可靠性，安全性
从进程角度看，机器负载，通信质量
服务映射到多个服务器
缓存
移动代码：applet
移动代理

###体系结构模式
* 分层
每层一个软件抽象
* 层次化体系结构
与分层互补
组织给定层功能的技术
* ajax
* 瘦客户
* 代理
* 业务代理
* 反射

###2.3.3 中间件解决方案
类别
最早：RPC 组通信ISIS
分布式对象;
分布式组件;
发布-订阅系统;
消息队列;
web服务;
对等;

限制
分布式程序的正确行为在很多层面依赖检查、错误校正机制、安全手段
底层中间件行为与一个给定应用或应用集的需求和相关环境上下文有关

##2.4基础模型
目的：
显式表示有关我们正在建模的系统的假设
给定这些假设，就可行性给出结论 算法，逻辑证明
###2.4.1 交互模型
影响进程交互的两个重要因素：
* 通信性能经常是一个限制特性
* 不可能维护一个全局时间概念

通信信道性能
延迟；带宽；抖动

计算机时钟和时序事件
时钟漂移率

####交互模型的两个变体
同步分布式系统
* 进程执行每一步的时间有一个上限和下限
* 通过通道传递的每个消息在一个已知的时间范围内收到
* 每个进程有个本地时钟，它与实际时间的偏移率在一个已知的范围内
给出偏移率简单，但保证偏移率很难

异步分布式系统
对下列因素没有限制：
* 进程执行速度
* 消息传递延迟
* 时钟飘移率

####事件排序
Pepperland协定
逻辑时钟

###2.4.2 故障模型
* 遗漏故障
进程遗漏故障，进程崩溃
对此检测：进程不能应答，依赖超时（崩溃/速度慢/消息还没到达）

* 通信遗漏故障
从进程p的外发缓冲区send到q的接收缓冲区，之间丢失
发送遗漏故障：发送进程-外发缓冲区之间
接收遗漏故障：接收缓冲区和接收进程之间
通道遗漏故障：以上之间的

* 随机故障
可能出现的最坏的故障

* 时序故障
适用于同步分布式系统

* 故障屏蔽
隐藏或将故障转换为一个更能接收的故障类型来屏蔽故障

* 一对一通信的可靠性
有效性：外发缓冲区的任何信息最终能传递到接收缓冲区
完整性：接收到的消息与发送的消息一致，没有消息被传送两次

###2.4.3 安全模型

保护对象
保护进程和交互
解除安全威胁
* 密码学和共享秘密
* 密码学
* 认证
* 安全通道

其他
* DDOS
* 移动代码


---
#C3 网络和网际互联
#3.1简介
性能
延迟
数据传输率
传输时间=延迟+length/数据传输率
#3.2 网络类型
PAN 个域网
LAN 局域网
WAN 广域网
MAN 城域网
WLAN 无线局域网
WMAN 无线城域网
互联网络

#3.3网络原理
##1 数据包的传输
长度有限的数据包：
* 需要分配缓存空间
* 避免长消息引起的通信空闲，而出现过度延迟

##数据流

##交换模式
广播
电路交换
包交换
帧中继

##协议
* 必须交换的消息的顺序的规约
* 消息中数据格式的规约

##3.3.5路由
距离向量算法
链路状态算法

##3.3.6拥塞控制
为了避免经过拥塞节点被丢弃，最好将数据包保存在拥塞之前的节点，直到拥塞减少
会增加延迟，但不会降低整个网络吞吐量

##3.3.7网际互联
实现集成需要：
* 统一的互联寻址方案
* 定义互连网络中的数据包格式并给出相应处理规则协议
* 互连组件

#3.4 互联网协议
##1 IP寻址
##2 IP协议
##3 IP路由

##4 IPv6

##5 移动IP

#3.5实力研究：以太网、Wifi、蓝牙
##1 以太网
数据包冲突
效率

##2 802.11无线LAN
工作站隐藏：由于无线电屏障，检测不到其他正在传输的主机
信号衰减：只能检测到有限距离内的冲突
冲突屏蔽

CSMA/CA 具有冲突避免的载波侦听多路复用

##3 802.15.1 蓝牙

---
#C4 进程间通信
#4.1 简介

#4.2 互联网协议的API
##1 进程间通信的特征
同步和异步
消息的目的地 


##2 套接字

##3 udp数据报通信
##4 tcp流通信
消息大小
丢失的消息
流控制
消息重复和排序
消息目的地

需要注意的问题
* 数据项匹配
* 阻塞
* 线程

###故障模型
网络不稳定 或严重拥塞 导致收不到确认，超时后，tcp会声明连接中断，如果还试图读写操作，则会受到通知，造成：
* 使用连接的进程不能区分网络故障还是连接另一端的进程故障
* 通信进程不能区分最近发送的消息是否已经被收到

#4.3 外部数据表示和编码
大端、小端
##二进制协议

##自描述协议
xml

#4.4 组播通信

#4.5 网络虚拟化：覆盖网络
##2 skype
super node

#4.6 实例研究 MPI

---
#C5 远程调用
#5.1 简介
#5.2 请求应答协议
基于通信原语：doOperation getRequest sendReply

##消息标示符
* requestId，递增整数序列
* 发送进程的标示符

##故障模型
如果基于UDP，则会遇到
* 遗漏故障
* 没有保障消息按照发送顺序进行传输

##超时
等待，或告知调用方

##丢弃重复的请求消息

##丢失应答信息
幂等

##历史

##交互协议的类型
请求协议 R
请求-应答协议 RR
请求-应答-确认协议 RRA

##请求-应答协议 TCP流的使用

#5.3 远程过程调用
##1 设计问题
接口编程
接口实现分离

###RPC调用语义
doOperation
重发请求消息
过滤重复请求
重传结果
或许调用语义

至少一次
至多一次

###透明性
故障定位
延迟
引用调用

##2 rpc实现

#5.4 远程方法调用
##1 设计问题

























