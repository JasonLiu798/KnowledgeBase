#DDD
---
#Theory
[DDD领域驱动设计基本理论知识总结](http://www.cnblogs.com/netfocus/archive/2011/10/10/2204949.html)
[领域驱动设计实现之路](http://www.infoq.com/cn/articles/implementation-road-of-domain-driven-design)

----
#构建领域的模型
最佳的方式是让软件成为领域的反射（映射）。
我们需要用模型来交流

软件设计
代码设计
    瀑布设计方法
    敏捷方法
        试图解决的另一个问题被称为“ 分析瘫痪” 

通用语言
模型->代码
    分析模型
       分析不能预见模型中存在的某些缺陷以及领域中的所有的复杂关系



#架构
DDD并不要求采用特定的架构风格，因为它是对架构中立的。你可以采用传统的三层式架构，也可以采用REST架构和事件驱动架构等。但是在《实现领域驱动设计》中，作者比较推崇事件驱动架构和六边形（Hexagonal）架构。
##六边形架构 端口和适配器（Ports and Adapters）
采用六边形架构的系统中存在着很多端口和适配器的组合。
端口表示的是一个软件系统的输入和输出
适配器则是对每一个端口的访问方式。

#分层
##用户界面/展现层
负责向用户展现信息以及解释用户命令。更细的方面来讲就是：
* 请求应用层以获取用户所需要展现的数据；
* 发送命令给应用层要求其执行某个用户命令；
##应用层
很薄的一层，用来协调应用的活动。它不包含业务逻辑。它不保留业务对象的状态，但它保有应用任务的进度状态。
##领域层
本层包含关于领域的信息。这是业务软件的核心所在。在这里保留业务对象的状态，对业务对象和它们状态的持久化被委托给了基础设施层。
##基础设施层
本层作为其他层的支撑库存在。它提供了层间的通信，实现对业务对象的持久化，包含对用户界面层的支撑库等作用。

---
#模型驱动设计
#领域对象 Domain Object
贫血对象，无法表明业务意图
将领域对象当做是服务的提供方，而不是数据容器，多思考一个领域对象能够提供哪些行为，而不是数据。

#实体 Entity
实体表示那些具有生命周期并且会在其生命周期中发生改变的东西；
实现实体意味着创建标识符
#值对象 Value Object
值对象则表示起描述性作用的并且可以相互替换的概念，具有“创建后不管”的特征
极力推荐值对象是不变的
一条箴言是：如果值对象是可共享的，那么它们应该是不可变的。

#聚合 Aggregate
聚合是一个用来定义对象所有权和边界的领域模式。
聚合是针对数据变化可以考虑成一个单元的一组相关的对象。
聚合使用边界将内部和外部的对象划分开来
聚合根：是一个实体，并且它是外部可以访问的唯一的对象。根可以保持对任意聚合对象的引用，并且其他的对象可以持有任意其他的对象，但一个外部对象只能持有根对象的引用。
难点：确定聚合的范围，过大导致性能问题，过小导致概念模糊

[关于领域驱动设计（DDD）中聚合设计的一些思考](http://www.cnblogs.com/netfocus/p/3307971.html)
聚合是用来封装真正的不变性，而不是简单的将对象组合在一起；
聚合应尽量设计的小；
    业务决定聚合，业务改变聚
聚合之间的关联通过ID，而不是对象引用；
聚合内强一致性，聚合之间最终一致性；


#资源库 Repository
用于保存和获取聚合对象
目的是封装所有获取对象引用所需的逻辑
换种说法是，资源库作为一个全局的可访问对象的存储点而存在
资源库关心的是已经存在的对象。
一种是基于集合的，一种是基于持久化的。


#领域服务 Domain Service
最好显式声明服务，因为它创建了领域中的一个清晰的特性，它封装了一个概念。
把这样的功能放入实体或者值对象都会导致混乱，因为那些对象的立场将变得不清楚
##特征
1.服务执行的操作涉及一个领域概念，这个领域概念通常不属于一个实体或者值对象。
2.被执行的操作涉及到领域中的其他的对象。
3.操作是*无状态*的。

#领域事件（Domain Event）
最终一致性取代了事务一致性，通过领域事件的方式达到各个组件之间的数据一致性
名词+动词过去分词

#工厂
将创建过程原子化非常重要。


#持续重构
#凸现关键概念

约束、过程和规约


#领域通用语言(Ubiquitous Language)

#限界上下文（Bounded Context）
##防崩溃层
隔离数据库和客户端
它最大的好处在于可以使客户端模型保持纯洁和持久，不会受到外部模型的干扰。
##共享内核
减少重复
##开放主机服务




#客户-供应商

#顺从者

#独立方法

#精炼




另外还要注意下面几个领域建模时的陷阱：
1)事必躬亲。模型需要代码。
2)专注于具体场景。抽象思维需要落地于具体案例。
3)不要试图对任何事情都进行领域驱动设计。画一张范围表，然后决定哪些应该进行领域驱动设计，哪些不用。不要担心边界之外的事情。
4)不停地实验，期望能产生错误。模型是一个创造性的流程。














#特点
领域模型是对具有某个边界的领域的一个抽象，反映了领域内用户业务需求的本质；领域模型是有边界的，只反应了我们在领域内所关注的部分；
领域模型只反映业务，和任何技术实现无关；领域模型不仅能反映领域中的一些实体概念，如货物，书本，应聘记录，地址，等；还能反映领域中的一些过程概念，如资金转账，等；
领域模型确保了我们的软件的业务逻辑都在一个模型中，都在一个地方；这样对提高软件的可维护性，业务可理解性以及可重用性方面都有很好的帮助；
领域模型能够帮助开发人员相对平滑地将领域知识转化为软件构造；
领域模型贯穿软件分析、设计，以及开发的整个过程；领域专家、设计人员、开发人员通过领域模型进行交流，彼此共享知识与信息；因为大家面向的都是同一个模型，所以可以防止需求走样，可以让软件设计开发人员做出来的软件真正满足需求；
要建立正确的领域模型并不简单，需要领域专家、设计、开发人员积极沟通共同努力，然后才能使大家对领域的认识不断深入，从而不断细化和完善领域模型；
为了让领域模型看的见，我们需要用一些方法来表示它；图是表达领域模型最常用的方式，但不是唯一的表达方式，代码或文字描述也能表达领域模型；
领域模型是整个软件的核心，是软件中最有价值和最具竞争力的部分；设计足够精良且符合业务需求的领域模型能够更快速的响应需求变化；






##领域建模时思考问题的角度

不能以用户为中心作为出发点去思考问题，不能老是想着用户会对系统做什么；而应该从一个客观的角度，根据用户需求挖掘出领域内的相关事物，思考这些事物的本质关联及其变化规律作为出发点去思考问题。
领域模型是与谁用和怎样用是无关的客观模型。归纳起来说就是，领域建模是建立虚拟模型让我们现实的人使用，而不是建立虚拟空间，去模仿现实。







---
#CQRS架构
Event Sourcing（事件溯源）



#DCI架构
DCI(D,数据，领域模型；C，上下文，用例；I，交互，对象扮演的角色）



---
#案例
[银行转账业务场景的几种实现思路对比](http://www.cnblogs.com/netfocus/archive/2011/04/17/2019152.html)
[借书场景领域建模浅析](http://www.cnblogs.com/netfocus/archive/2013/04/08/3009113.html)




---
#资料
Eric Evans
[领域驱动设计](http://book.douban.com/subject/1629512/)
Vaughn Vernon
[实现领域驱动设计](http://book.douban.com/subject/25844633/)
















